<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QUARKS</title>
<style>
:root{
  --bg: linear-gradient(135deg,#3a1c71,#d76d77,#ffaf7b);
  --chat-width: 100%;
}
html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial;background:var(--bg);}
.wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:12px;box-sizing:border-box;}
.card{
  width:100%;max-width:var(--chat-width);
  height:86vh;border-radius:16px;display:flex;flex-direction:column;overflow:hidden;
  background:rgba(255,255,255,0.06);backdrop-filter:blur(8px);box-shadow:0 10px 30px rgba(0,0,0,0.35);
  border:1px solid rgba(255,255,255,0.04);
}

/* header */
.header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:rgba(255,255,255,0.03)}
.title{font-weight:700;color:#fff;display:flex;gap:10px;align-items:center;font-size:16px}
.controls{display:flex;gap:8px;align-items:center}
.btn {background:rgba(255,255,255,0.06);color:#fff;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-size:14px}

/* join area */
#joinArea{display:flex;gap:8px;padding:10px;align-items:center;flex-wrap:wrap;}
#joinArea input{padding:10px;border-radius:10px;border:none;outline:none;background:rgba(255,255,255,0.03);color:#fff;flex:1;min-width:120px}
#joinArea button{background:#ff7aa2;color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}

/* chat area */
.chatArea{display:flex;flex-direction:column;flex:1;min-height:0;position:relative;}
#messages{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
.bubble{max-width:72%;padding:10px 12px;border-radius:14px;color:#fff;word-wrap:break-word;box-shadow:0 4px 10px rgba(0,0,0,0.2)}
.meta{font-size:12px;opacity:0.75;margin-bottom:4px}
.mine{align-self:flex-end;background:linear-gradient(120deg,#4facfe,#00f2fe);border-bottom-right-radius:4px;text-align:right}
.their{align-self:flex-start;background:linear-gradient(120deg,#ff9a9e,#fecfef);color:#111;border-bottom-left-radius:4px;text-align:left}
.time{display:block;font-size:11px;opacity:0.75;margin-top:4px}
.receipt{font-size:12px;opacity:0.8;margin-left:6px}

/* typing status */
#typingStatus{padding:6px 12px;font-size:13px;color:rgba(255,255,255,0.85);min-height:20px}

/* input bar */
.inputBar{display:flex;gap:8px;padding:10px;background:rgba(0,0,0,0.12);align-items:center}
#msgBox{flex:1;padding:10px 12px;border-radius:12px;border:none;outline:none;background:rgba(255,255,255,0.04);color:#fff;font-size:15px}
.iconBtn{background:rgba(255,255,255,0.06);border-radius:12px;padding:10px;border:none;color:#fff;cursor:pointer;font-size:18px}
#sendBtn{background:#ff6a95;color:#fff;padding:10px 14px;border-radius:12px;border:none;cursor:pointer}

/* emoji picker */
#emojiPicker{position:absolute;bottom:60px;left:10px;width:250px;max-height:200px;background:rgba(255,255,255,0.06);backdrop-filter:blur(8px);padding:8px;border-radius:12px;display:none;overflow:auto;flex-wrap:wrap;gap:5px;z-index:40}
.emoji{font-size:20px;padding:6px;cursor:pointer}

/* settings panel outside */
#settingsPanel{position:fixed;top:80px;right:10px;background:rgba(0,0,0,0.5);padding:12px;border-radius:10px;display:none;color:#fff;z-index:40;min-width:180px}
.bgOption{padding:8px;margin:6px 0;border-radius:8px;cursor:pointer;text-align:center;background:rgba(255,255,255,0.03)}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="card">

    <div class="header">
      <div class="title">Chat</div>
      <div class="controls">
        <div id="roomLabel" class="btn" style="font-weight:normal;">room: ‚Äî</div>
        <button id="settingsBtn" class="btn">‚öôÔ∏è Settings</button>
      </div>
    </div>

    <!-- JOIN -->
    <div id="joinArea">
      <input id="roomInput" placeholder="Room name (rose123)" />
      <input id="nickInput" placeholder="Your name (Quarks)" />
      <button id="joinBtn">Join</button>
    </div>

    <!-- settings panel -->
    <div id="settingsPanel">
      <div style="font-weight:700;margin-bottom:6px">Backgrounds</div>
      <div class="bgOption" data-id="1">Blue ‚Üí Purple</div>
      <div class="bgOption" data-id="2">Pink ‚Üí Orange</div>
      <div class="bgOption" data-id="3">Teal ‚Üí Blue</div>
      <div class="bgOption" data-id="4">Night Black</div>
      <hr style="border:none;height:8px">
      <div style="font-size:13px;opacity:0.9">Chat width</div>
      <div style="display:flex;gap:6px;margin-top:6px;flex-wrap:wrap">
        <button class="btn" data-width="90%">Narrow</button>
        <button class="btn" data-width="100%">Full</button>
      </div>
    </div>

    <!-- CHAT -->
    <div class="chatArea" id="chatArea">
      <div id="emojiPicker"></div>
      <div id="messages" aria-live="polite"></div>
      <div id="typingStatus"></div>
    </div>

    <!-- INPUT -->
    <div class="inputBar">
      <button id="emojiBtn" class="iconBtn">üòä</button>
      <input id="msgBox" placeholder="Write a message ‚Äî Enter sends (Shift+Enter newline)" />
      <button id="sendBtn">Send</button>
    </div>

  </div>
</div>

<script>
const WS_URL = "wss://hack.chat/chat-ws";
let ws = null;
let room = "";
let nick = "";
let typingTimeout = null;
const messagesEl = document.getElementById("messages");
const msgBox = document.getElementById("msgBox");
const sendBtn = document.getElementById("sendBtn");
const emojiBtn = document.getElementById("emojiBtn");
const emojiPicker = document.getElementById("emojiPicker");
const settingsBtn = document.getElementById("settingsBtn");
const settingsPanel = document.getElementById("settingsPanel");
const bgOptions = settingsPanel.querySelectorAll(".bgOption");
const widthBtns = settingsPanel.querySelectorAll("button[data-width]");
const joinBtn = document.getElementById("joinBtn");
const roomInput = document.getElementById("roomInput");
const nickInput = document.getElementById("nickInput");
const roomLabel = document.getElementById("roomLabel");
const typingStatus = document.getElementById("typingStatus");

const EMOJI_LIST = ["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòã","üòé","üòç","üòò","ü•∞","üôÇ","ü§ó","ü§©","ü§î","üòê","üò∂","üôÑ","üòè","üò£","üò•","üòÆ","üòØ","üò™","üò´","üò¥","üòå","üòõ","üòú","üòù","üòí","üòì","üòî","üòï","üôÉ","ü•≤","üò≤","üò∂‚Äçüå´Ô∏è","üò≥","ü•∫","üò¢","üò≠","üò§","üò°","üò†","ü§¨","üòà","üëª","üíÄ","ü§ñ","üëΩ","üëç","üëé","üôè","üëè","üíñ","‚ù§Ô∏è","üî•","üåü","‚ú®","üéâ","üé∂","üåπ","üåô"];

function populateEmoji(){
  emojiPicker.innerHTML = "";
  EMOJI_LIST.forEach(e=>{
    const s=document.createElement("span");
    s.className="emoji";
    s.textContent=e;
    s.onclick=()=>{msgBox.value+=e;msgBox.focus();}
    emojiPicker.appendChild(s);
  });
}
populateEmoji();

emojiBtn.addEventListener("click", e=>{
  e.stopPropagation();
  emojiPicker.style.display = emojiPicker.style.display === "block" ? "none" : "block";
});
document.addEventListener("click", e=>{
  if (emojiPicker.style.display === "block" && !emojiPicker.contains(e.target) && e.target !== emojiBtn){
    emojiPicker.style.display="none";
  }
  if (settingsPanel.style.display==="block" && !settingsPanel.contains(e.target) && e.target!==settingsBtn){
    settingsPanel.style.display="none";
  }
});

settingsBtn.addEventListener("click", e=>{
  e.stopPropagation();
  settingsPanel.style.display = settingsPanel.style.display === "block" ? "none" : "block";
});
bgOptions.forEach(o=>{
  o.addEventListener("click", ()=>{
    const id=o.dataset.id;
    switch(id){
      case "1": document.documentElement.style.setProperty('--bg','linear-gradient(135deg,#3a1c71,#d76d77,#ffaf7b)'); break;
      case "2": document.documentElement.style.setProperty('--bg','linear-gradient(135deg,#ff6a88,#ff99ac)'); break;
      case "3": document.documentElement.style.setProperty('--bg','linear-gradient(135deg,#11998e,#38ef7d)'); break;
      case "4": document.documentElement.style.setProperty('--bg','linear-gradient(135deg,#0f0f0f,#1e1e1e)'); break;
    }
    settingsPanel.style.display="none";
  });
});
widthBtns.forEach(b=>{b.addEventListener("click",()=>{document.documentElement.style.setProperty('--chat-width',b.dataset.width);});});

function genId(){return Date.now().toString(36)+Math.random().toString(36).slice(2,8);}
function nowTime(){const d=new Date(),h=d.getHours(),m=String(d.getMinutes()).padStart(2,'0'),ampm=h>=12?"PM":"AM";h=h%12||12;return `${h}:${m} ${ampm}`;}
function renderMessage(nickVal,textVal,statusVal){
  const wrap=document.createElement("div");wrap.className="bubble "+(nickVal===nick?"mine":"their");
  const meta=document.createElement("div");meta.className="meta";meta.textContent=nickVal;wrap.appendChild(meta);
  const t=document.createElement("div");t.innerText=textVal;wrap.appendChild(t);
  const footer=document.createElement("div");footer.style.display="flex";footer.style.justifyContent=nickVal===nick?"flex-end":"flex-start";footer.style.alignItems="center";footer.style.gap="6px";
  const time=document.createElement("span");time.className="time";time.textContent=nowTime();footer.appendChild(time);
  if(nickVal===nick){const r=document.createElement("span");r.className="receipt";r.textContent=statusVal==="seen"?"‚úì‚úì Seen":statusVal==="delivered"?"‚úì Delivered":"";footer.appendChild(r);}
  wrap.appendChild(footer);messagesEl.appendChild(wrap);messagesEl.scrollTop=messagesEl.scrollHeight;
}

/* WebSocket */
function connectWS(){
  ws=new WebSocket(WS_URL);
  ws.onopen=()=>{ws.send(JSON.stringify({cmd:"join",channel:room,nick}));}
  ws.onmessage=(ev)=>{
    try{
      const data=JSON.parse(ev.data);
      if(data.cmd==="chat"){if(data.nick!==nick){renderMessage(data.nick,data.text,"");}else{renderMessage(data.nick,data.text,"delivered");}}
      if(data.cmd==="typing"&&data.nick!==nick){typingStatus.textContent=`${data.nick} is typing‚Ä¶`;}
      if(data.cmd==="stoptyping"&&data.nick!==nick){typingStatus.textContent="";}
    }catch(e){console.warn("ws error",e);}
  };
  ws.onclose=()=>{typingStatus.textContent="Disconnected from server.";}
}

function sendMessage(){const text=msgBox.value.trim();if(!text||!ws||ws.readyState!==WebSocket.OPEN)return;renderMessage(nick,text,"");ws.send(JSON.stringify({cmd:"chat",text}));msgBox.value="";ws.send(JSON.stringify({cmd:"stoptyping",room,nick}));}
function sendTyping(){if(!ws||ws.readyState!==WebSocket.OPEN)return;ws.send(JSON.stringify({cmd:"typing",room,nick}));clearTimeout(typingTimeout);typingTimeout=setTimeout(()=>{if(ws&&ws.readyState===WebSocket.OPEN)ws.send(JSON.stringify({cmd:"stoptyping",room,nick}));},900);}

joinBtn.addEventListener("click",()=>{const r=roomInput.value.trim(),n=nickInput.value.trim();if(!r||!n)return alert("Enter room and your name");room=r;nick=n;roomLabel.textContent="room: "+room;document.getElementById("joinArea").style.display="none";connectWS();});
sendBtn.addEventListener("click",sendMessage);
msgBox.addEventListener("keydown",(e)=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendMessage();}else sendTyping();});
</script>
</body>
</html>
