<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>quarks</title>
<style>
  :root{
    --bg: linear-gradient(135deg,#3a1c71,#d76d77,#ffaf7b);
  }
  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial;background:var(--bg);}
  .wrap{min-height:100vh;display:flex;flex-direction:column;}
  .card{
    flex:1;display:flex;flex-direction:column;overflow:hidden;
    background:rgba(255,255,255,0.06);backdrop-filter:blur(8px);
    border:1px solid rgba(255,255,255,0.04);
  }

  /* header */
  .header{display:flex;align-items:center;justify-content:space-between;padding:10px;background:rgba(255,255,255,0.03)}
  .title{font-weight:700;color:#fff;display:flex;gap:10px;align-items:center}
  .controls{display:flex;gap:8px;align-items:center}
  .btn {background:rgba(255,255,255,0.06);color:#fff;padding:6px 10px;border-radius:8px;border:none;cursor:pointer;font-size:14px}

  /* join area */
  #joinArea{display:flex;flex-wrap:wrap;gap:6px;padding:8px;align-items:center}
  #joinArea input{flex:1;min-width:120px;padding:8px;border-radius:10px;border:none;outline:none;background:rgba(255,255,255,0.03);color:#fff;font-size:14px}
  #joinArea button{background:#ff7aa2;color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-size:14px}

  /* chat area */
  .chatArea{display:flex;flex-direction:column;flex:1;min-height:0;position:relative}
  #emojiPicker{position:absolute;bottom:60px;left:8px;width:calc(100% - 16px);max-height:200px;background:rgba(255,255,255,0.06);backdrop-filter:blur(8px);padding:8px;border-radius:12px;display:none;overflow:auto;flex-wrap:wrap;gap:6px;z-index:40}
  .emoji{font-size:20px;padding:6px;cursor:pointer}
  #messages{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:8px}
  .bubble{max-width:80%;padding:10px 12px;border-radius:14px;color:#fff;word-wrap:break-word;box-shadow:0 2px 6px rgba(0,0,0,0.2)}
  .meta{font-size:12px;opacity:0.75;margin-bottom:4px}
  .mine{align-self:flex-end;background:linear-gradient(120deg,#4facfe,#00f2fe);border-bottom-right-radius:4px;text-align:right}
  .their{align-self:flex-start;background:linear-gradient(120deg,#ff9a9e,#fecfef);color:#111;border-bottom-left-radius:4px;text-align:left}
  .time{display:block;font-size:11px;opacity:0.75;margin-top:4px}
  #typingStatus{padding:4px 12px;font-size:13px;color:rgba(255,255,255,0.85);min-height:20px}

  /* input bar */
  .inputBar{display:flex;gap:6px;padding:8px;background:rgba(0,0,0,0.12);align-items:center}
  #msgBox{flex:1;padding:10px 12px;border-radius:12px;border:none;outline:none;background:rgba(255,255,255,0.04);color:#fff;font-size:14px}
  .iconBtn{background:rgba(255,255,255,0.06);border-radius:12px;padding:8px;border:none;color:#fff;cursor:pointer;font-size:18px}
  #sendBtn{background:#ff6a95;color:#fff;padding:8px 12px;border-radius:12px;border:none;cursor:pointer;font-size:14px}

  /* small helper */
  .muted{opacity:0.8;font-size:13px;color:rgba(255,255,255,0.9)}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">

    <div class="header">
      <div class="title">Chat</div>
      <div class="controls">
        <div id="roomLabel" class="muted">room: â€”</div>
      </div>
    </div>

    <!-- JOIN -->
    <div id="joinArea">
      <input id="roomInput" placeholder="Room name (rose123)" />
      <input id="nickInput" placeholder="Your name (Quarks)" />
      <button id="joinBtn">Join</button>
    </div>

    <!-- CHAT -->
    <div class="chatArea" id="chatArea">
      <div id="emojiPicker"></div>
      <div id="messages" aria-live="polite"></div>
      <div id="typingStatus"></div>
    </div>

    <!-- INPUT -->
    <div class="inputBar">
      <button id="emojiBtn" class="iconBtn">ðŸ˜Š</button>
      <input id="msgBox" placeholder="Type message â€” Enter sends" />
      <button id="sendBtn">Send</button>
    </div>

  </div>
</div>

<script>
const WS_URL="wss://hack.chat/chat-ws";
let ws=null,room="",nick="",typingTimeout=null,emojiOpen=false;

const roomInput=document.getElementById("roomInput");
const nickInput=document.getElementById("nickInput");
const joinBtn=document.getElementById("joinBtn");
const roomLabel=document.getElementById("roomLabel");
const messagesEl=document.getElementById("messages");
const msgBox=document.getElementById("msgBox");
const sendBtn=document.getElementById("sendBtn");
const typingStatus=document.getElementById("typingStatus");
const emojiBtn=document.getElementById("emojiBtn");
const emojiPicker=document.getElementById("emojiPicker");

const EMOJI_LIST=["ðŸ˜€","ðŸ˜","ðŸ˜‚","ðŸ¤£","ðŸ˜ƒ","ðŸ˜„","ðŸ˜…","ðŸ˜†","ðŸ˜‰","ðŸ˜Š","ðŸ˜‹","ðŸ˜Ž","ðŸ˜","ðŸ˜˜","ðŸ¥°","ðŸ™‚","ðŸ¤—","ðŸ¤©","ðŸ¤”","ðŸ˜","ðŸ˜¶","ðŸ™„","ðŸ˜","ðŸ˜£","ðŸ˜¥","ðŸ˜®","ðŸ˜¯","ðŸ˜ª","ðŸ˜«","ðŸ˜´","ðŸ˜Œ","ðŸ˜›","ðŸ˜œ","ðŸ˜","ðŸ˜’","ðŸ˜“","ðŸ˜”","ðŸ˜•","ðŸ™ƒ","ðŸ¥²","ðŸ˜²","ðŸ˜¶â€ðŸŒ«ï¸","ðŸ˜³","ðŸ¥º","ðŸ˜¢","ðŸ˜­","ðŸ˜¤","ðŸ˜¡","ðŸ˜ ","ðŸ¤¬","ðŸ˜ˆ","ðŸ‘»","ðŸ’€","ðŸ¤–","ðŸ‘½","ðŸ‘","ðŸ‘Ž","ðŸ™","ðŸ‘","ðŸ’–","â¤ï¸","ðŸ”¥","ðŸŒŸ","âœ¨","ðŸŽ‰","ðŸŽ¶","ðŸŒ¹","ðŸŒ™"];

function genId(){return Date.now().toString(36)+Math.random().toString(36).slice(2,8);}
function nowTime(){const d=new Date();let h=d.getHours();let m=String(d.getMinutes()).padStart(2,'0');const a=h>=12?"PM":"AM";h=h%12||12;return `${h}:${m} ${a}`;}

function renderMessage(nickVal,textVal){
  const wrap=document.createElement("div");
  wrap.className="bubble "+(nickVal===nick?"mine":"their");
  const meta=document.createElement("div");meta.className="meta";meta.textContent=nickVal;wrap.appendChild(meta);
  const txt=document.createElement("div");txt.innerText=textVal;wrap.appendChild(txt);
  const t=document.createElement("span");t.className="time";t.textContent=nowTime();wrap.appendChild(t);
  messagesEl.appendChild(wrap);
  messagesEl.scrollTop=messagesEl.scrollHeight;
}

/* =================== WebSocket =================== */
function connectWS(){
  ws=new WebSocket(WS_URL);
  ws.onopen=()=>{ws.send(JSON.stringify({cmd:"join",channel:room,nick}));};
  ws.onmessage=(ev)=>{
    try{
      const data=JSON.parse(ev.data);
      if(data.cmd==="chat"){renderMessage(data.nick,data.text);}
      if(data.cmd==="typing"&&data.nick!==nick){typingStatus.textContent=`${data.nick} is typingâ€¦`;}
      if(data.cmd==="stoptyping"&&data.nick!==nick){typingStatus.textContent="";}
    }catch(e){console.warn(e);}
  };
  ws.onclose=()=>{typingStatus.textContent="Disconnected";}
}

function sendMessage(){
  const text=msgBox.value.trim();if(!text||!ws||ws.readyState!==WebSocket.OPEN)return;
  renderMessage(nick,text);
  ws.send(JSON.stringify({cmd:"chat",text}));
  msgBox.value="";
  ws.send(JSON.stringify({cmd:"stoptyping",room,nick}));
}

function sendTyping(){if(!ws||ws.readyState!==WebSocket.OPEN)return;ws.send(JSON.stringify({cmd:"typing",room,nick}));clearTimeout(typingTimeout);typingTimeout=setTimeout(()=>{if(ws&&ws.readyState===WebSocket.OPEN)ws.send(JSON.stringify({cmd:"stoptyping",room,nick}));},900);}

/* =================== Events =================== */
joinBtn.addEventListener("click",()=>{
  const r=roomInput.value.trim();const n=nickInput.value.trim();
  if(!r||!n)return alert("Enter room & name");
  room=r;nick=n;
  roomLabel.textContent="room: "+room;
  connectWS();
  document.getElementById("joinArea").style.display="none";
});

sendBtn.addEventListener("click",sendMessage);
msgBox.addEventListener("keydown",e=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();sendMessage();}else{sendTyping();}});

/* emoji picker */
function populateEmoji(){emojiPicker.innerHTML="";EMOJI_LIST.forEach(e=>{const s=document.createElement("span");s.className="emoji";s.textContent=e;s.onclick=()=>{msgBox.value+=e;msgBox.focus();};emojiPicker.appendChild(s);});}
populateEmoji();

emojiBtn.addEventListener("click",ev=>{ev.stopPropagation();emojiOpen=!emojiOpen;emojiPicker.style.display=emojiOpen?"flex":"none";document.body.appendChild(emojiPicker);});
document.addEventListener("click",ev=>{if(emojiOpen){if(!emojiPicker.contains(ev.target)&&ev.target!==emojiBtn){emojiOpen=false;emojiPicker.style.display="none";}}});

</script>
</body>
</html>
